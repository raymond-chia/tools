# Claude Code 規則文件

本檔案定義 Claude Code 在本專案中應遵守的規則和決策原則。

## 禁止項（最優先檢查）

在任何程式碼修改之前，必須檢查以下禁止項：

1. 禁止簡體中文。所有註解、文檔和回應必須使用繁體中文。
2. 禁止使用 unwrap()。應使用 expect() 並附帶清晰的錯誤訊息，訊息應包含具體的操作和預期值。
3. 禁止使用 let else。應使用 match 敘述，確保編譯器能檢查 exhaustiveness。
4. 禁止使用 magic numbers 或 magic strings。所有數值和字串常數應定義為具名常數。
5. 禁止在 Component 結構上實現 impl 區塊。所有行為應透過 derive 或外部函數實現。
6. 禁止在同一作用域內使用相似的變數名。例如不應同時存在 attr 和 attribute。
7. 禁止進入內建 plan mode

## 語言和溝通原則

使用繁體中文進行所有溝通、註解和文檔。簡體中文絕對禁止。

先討論後實作。遇到不明確的需求或需要做出設計決策時，應先與用戶討論方案並取得確認，而不是直接開始實作或盲目同意用戶的建議。

## 程式碼設計原則

Single responsibility principle：每個檔案、函數和型別應只負責單一職責，不混合多個關注點。

Functional programming：使用函數式風格，避免物件導向設計。使用 match 和高階函數，避免 OOP 模式。

優先 derive，不手動實現。對於 Default、Clone、Debug、Copy 等 trait，應優先使用 derive 屬性，只在無法 derive 時才手動實現。

使用 KISS 策略。只補現在用到的內容。不預先添加暫時不用的方法、錯誤類型或 derive 區塊。當功能真正需要時再添加。

變數命名應具有辨識度。避免過度縮寫，避免在同一作用域內使用易混淆的相似名稱。

使用 fail fast 策略。在函數開頭進行所有驗證和參數檢查，發現問題立即返回錯誤，而不在執行中間進行檢查。

錯誤訊息應包含豐富上下文。錯誤訊息應說明發生了什麼操作、預期的值是什麼、實際的值是什麼。

use 語句應放在檔案頂部。不應在函數內部宣告 use。

## 技術判斷原則

設計建議必須經過驗證，不能盲目同意。對於任何設計建議或技術決策，應透過測試、推導或實驗來驗證其有效性，而不是假設其正確性。

區分理論上可能與確實有效。一個方案在理論上可能可行，但實踐中可能有問題。應以實際驗證結果為基準。

## 本專案特定規則

本專案是戰術回合制 RPG 遊戲，使用 Rust 編寫。

禁止向後相容。允許破壞現有 API 來改進設計。

優先使用 type alias。使用 core/board/src/alias.rs 中定義的類型別名（Coord、MovementCost、ID、TypeName、SkillName）來提升語義清晰度。

檢查設計機制。實作完成後，應檢查是否違反 README-設計機制.md 中的設計規則。如果只是尚未實作完畢，只需提示尚未實作。如果存在違反，應警告用戶。

更新索引文件。實作新功能或修改結構後，應更新 rules/\*-index.md 文件，保持文檔的準確性。

## 檢查指令

```sh
cd "D:\Mega\prog\rust\tools" && cargo check -p editor 2>&1 | head -50
```
