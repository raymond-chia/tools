# 遊戲設計機制文檔

## 核心願景

### 你希望遊戲的核心樂趣是什麼？

- 規劃戰術, 逐一嘗試戰術是否有效。最終發現戰術能穩定成功時會有成就感
- 需要有某種程度的隨機性, 以免像是在下棋, 並產生最優解
- 不能隨機出現敵人, 以免難以設計戰術
- 需要根據喜好戰術培養角色, 讓不同角色使用不同技能合作達成戰術

- 比方來說 pathfinder wrath of the righteous 的 through the ashes DLC 中, 會需要利用地形甚至機關來對付敵人
- 需要針對性培養角色, 才好應付無法依靠地利對付的敵人

### 你希望玩家在戰鬥中主要做什麼決策？

- 主要是根據戰術施放技能, 一步一步完成戰術
- 戰術需要考量資源分配, 比如法術會消耗 MP
- 戰術可能包含位置, 比如把敵人推下懸崖, 或者堵住隘口讓後排盡情輸出
- 重要元素: 位置（光、掩體、高地命中、夾擊、line of sight）、位移（製造地形、利用地形、元素反應）、反應動作、壓力機制、fog of war

# 嘗試定義

## 優先度高

請協助我完善遊戲機制設計稿
請保持精簡，太長我看不下去
如果發現 scope creep 請提醒我

- 單人製作
- 回合制戰棋
- 格子是正方形
  - 使用曼哈頓距離
    - 也就是一個單位的周遭只有 4 格，而不是 8 格
  - 格子沒有高度
  - 格子有明亮、昏暗、黑暗
  - 昏暗會降低命中與閃避。黑暗會降低命中與閃避，且切斷 line of sight
  - 使用技能當下，會檢查攻擊者與目標的感知能力。如果有聽覺定位，可以免除命中/閃避減益。如果在昏暗環境且有夜視能力，也可以免除命中/閃避減益
  - 沒有地圖迷霧，黑暗中也可以看到敵人確切位置
  - 不允許單體攻擊感知不到的地方。只有擁有聽覺定位的單位可以在黑暗中單體攻擊
  - 聽覺可以想像成視線系統，只檢查直線距離 & 直線是否有地圖物件會阻擋 (bresenham line)
    - 聲音就只是第二套視覺系統，但是被不同的地圖物件阻擋。沒有甚麼模糊感知之類的東西，不要一直亂幻想
  - 不以單位為目標的範圍技能可以施放到無法感知的格子
- 有地圖物件
  - 有些物件可以造成即死、阻止通過、阻擋視線定位、阻擋聲音定位
  - 沒有掩體，只有阻擋視線、聽覺的障礙物
- 行動機制只能移動 + 技能（包含裝備、物品）
  - 只能 `移動 + 移動` 或者 `移動 + 使用技能` 或者 `只使用技能`
  - 唯有特殊技能可以在使用後繼續移動，否則使用技能後不能移動或使用其他技能
  - 移動距離根據角色 mov 屬性
  - 任意移動可以走任意路徑。只要沒消耗完 mov 就算同一次移動
  - 移動 + 移動的移動距離就是兩倍 mov 屬性
  - 只能穿越友軍，不能穿越敵軍、阻止通過的物件
  - 不能停在其他單位的格子上
- 單位按照 ini 屬性，每一輪根據 ini + 1d6 決定順序
  - 如果尚未移動/使用技能，可以延後到該輪任意位置
    - 回合效果都在回合開始的時候觸發，並檢查是否過期。在回合結束的時候扣除時效
    - 延後的回合不會觸發回合效果，因為在延後之前就觸發了 (觸發效果、檢查過期、扣除時效)
- 命中率是角色命中 + 技能命中 + 1d100 跟敵人閃避、格擋比較
  - 整個判定只取一個亂數
  - 亂數 `>` 95 視為命中成功 (閃避失敗、格擋失敗)；亂數 `<` 5 視為閃避成功
  - 命中 + 技能命中 + 1d100 `<` 敵人閃避，則該次技能無效
  - 命中 + 技能命中 + 1d100 `<` 敵人閃避 + 格擋，則該次傷害降低，降低數值根據敵人格擋保護值 (不是格擋率)(最終傷害 = 傷害 × (1 - 格擋保護值))，命中效果變弱
  - 命中 + 技能命中 + 1d100 `>` 敵人閃避 + 格擋，則該次傷害不變，命中效果不變
  - 如果格擋/命中且該次亂數達到該次技能暴擊率 (亂數 > 100 - 暴擊率)，則傷害 ×2，命中效果不變 (也就是就算格擋了，被減少的最終傷害會 ×2)
- 範圍技能不管命中，而是判斷攻擊者 dc + 技能 DC 跟敵人強韌或反射或意志 +1d100
  - 如果敵人檢定成功，則傷害減半，效果變弱
  - 如果敵人檢定失敗，則傷害不變，效果不變
- 有位移技能，可以推單位到即死位置 (參考地圖物件)
  - 單位被推到即死位置就會直接死亡，沒有任何檢定
- 角色
  - hp、mp、ini、命中、閃避、格擋、格擋保護、物理攻擊力、魔法攻擊力、魔法檢定難度、強韌、反射、意志、mov、藉機攻擊次數
  - 命中、閃避、格擋沒有數值上限
  - 角色屬性都是靠被動技能 (& 狀態) 加總獲得
- skill
  - 技能沒有冷卻時間，有些有 mp 消耗
- 關卡
  - 勝利條件依照關卡而定。例如消滅所有敵人；消滅關鍵敵人；存活指定回合；到達指定地點；保護指定目標指定回合；保護指定目標到達指定地點
  - 失敗條件依照關卡而定。例如隊伍全滅；關鍵敵人逃離戰場；保護的目標死亡
  - 小隊冒險。玩家隨故事進展會達到六人小隊

---

- 實作上是 rust, godot, data driven, ecs, 盡量 tdd
- 技能還沒想好
- 或許不讓單位升級有數值成長，只讓單位能學到更多技能，與換更高數值的裝備
- 不確定關卡怎麼設計，但是預計遊玩時間 20 hr

## 優先度中

- 大地圖隱匿與被偵測機制，被偵測 (敵人 8 格內 & 在敵人 line of sight 或者聽覺定位範圍內) 到就開戰

## 優先度低，先不做

- tech
  - 根據敵我的偵測與隱匿檢定差距，決定多遠可以偵測到隱匿單位（偵測 vs 隱匿被動加值每差 2 可以早一格偵測到）
    - 沒有特殊地形的話，就算偵測很低也能偵測到旁邊一格，就算偵測很高也只能偵測到 12 格內
    - 如果偵測跟隱匿加值相同（比如都升級到最高），則偵測範圍是 4 格
    - 每次升級可以用技巧點數提升偵測或隱匿（或者其他 tech）
      - tech 都是在比大小（無論是跟環境比還是跟其他單位比）
      - skill 是增加技能，比如產生冰柱、煙霧彈、火焰攻擊等等
  - 如果冰柱/煙霧消失（被打壞、過期）且後面的單位在對手 line of sight 內 & 偵測範圍內，會解除隱匿
  - 隱匿可以避開部分敵人; 可以在開戰前佔據有利位置
    - 隱匿時命中有優勢（roll 1d100 with adv）（骰到暴擊的機率也會因此上升）
    - 攻擊後如果在敵人 los 內，會解除隱匿（所以只有切斷 los 的情況下靠 AoE 可以在攻擊敵人後維持隱匿）
      - AoE 目標點必須在自己的 los，但是攻擊覆蓋範圍的其他點不需要在 los
    - 在敵人 12 格內使用技能，會讓敵人知道單位在哪一格
      - skill 最遠 12 格
    - 開打後不容易再次隱匿（需要切斷 los，並使用隱匿技能）
